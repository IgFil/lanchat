<html>
    <head>
        <meta charset="UTF-8">
        <title>Чат</title>
        <script language="JavaScript">
            window.onload = function(){
                var inp_message = document.querySelector('input[name=message_inp]');
                document.querySelector('#enter').onclick = function(){
                if (document.querySelector('#nick').value == ""){
                }else{
                    if(document.querySelector('#nick').value,length <= 10){
                    document.cookie = "name=" + document.querySelector('#nick').value;
                    window.location.reload();}}

                }
                document.querySelector('#go').onclick = function() {
                if (inp_message.value == ""){

                }else{

                if (inp_message.value.length <= 30) {
                    var params = 'message=' + inp_message.value + '&' + document.cookie;
                ajaxPost(params, "cgi-bin/message_input.py");}
                }
                }
                console.log(document.cookie);
                if (document.cookie !== ""){
            document.querySelector('#popup').style.display = 'none';
            }
            }
            function ajaxPost(params, action){
            var xhr = new XMLHttpRequest();
            xhr.open("POST", action, true);
            xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
            xhr.send(params);
            }
            function ajaxPost_2(params, action){
            var xhr = new XMLHttpRequest();
            xhr.open("POST", action, true);
            xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
            xhr.send(params);
            xhr.onreadystatechange = function(){
            if(xhr.readyState == 4 && xhr.status == 200){
            output = xhr.responseText;
            console.log(output);
            document.querySelector('#text_holder').innerHTML = output;
            }
            }
            }
            window.setInterval(function(){
                var id_message = document.querySelector('p:first-child');
                var params = 'id=' + id_message.id;
                ajaxPost_2(params, "cgi-bin/message_output.py");




            }
            ,1000);

        </script>
    </head>
    <body>
    <style>
        .input_message{
        margin: auto;
        width: 300px;
        }
        #text_holder{
        margin-top: 20%;
        height: 50%;
        overflow: auto;
        margin:auto;
        width: 500px;
        }
        #popup{
        z-index: 1;
        position: absolute;
        margin: auto;
        width: 100%;
        height: 30%;
        top: 0%;
        padding-top:10%;
        padding-left:40%;
        padding-bottom:70%;
        padding-right:60%;

        background-color: maroon;
        }
        #nick{
        border-radius: 3px;
        border-style: solid;
        width:20%;
        height:30%;
        }
        #enter{
        height:30%;
        border-radius: 3px;
        border-style: solid;
        width:10%;
        }
        #register_l{
        font-size: 30px;
        font-weight: bold;
        color: blue;
        }
    </style>
    <div>
        <div id="text_holder">
            <p id="0">Чат пуст</p>
        </div>
        <div class="input_message">
            <form>
                <input name="message_inp" type="text" placeholder="Сообщение">
                <input type="button" id="go" value="отправить">
            </form>
        </div>
    </div>
    <div id="popup">
        <form>
            <label id="register_l" >Регистрация</label>
            <br>
            <input id="nick" required placeholder="nick" name="nick" type="text">
            <input type="button"  id="enter" value="войти">
        </form>
    </div>
    </body>
</html>
