<html>
    <head>
        <meta charset="UTF-8">
        <title>Чат</title>
        <script language="JavaScript">
            window.onload = function(){
                var inp_message = document.querySelector('input[name=message_inp]');
                document.querySelector('#enter').onclick = function(){
                if (document.querySelector('#nick').value == ""){
                }else{
                    if(document.querySelector('#nick').value,length <= 10){
                    document.cookie = "name=" + document.querySelector('#nick').value;
                    window.location.reload();}}

                }
                document.querySelector('#go').onclick = function() {
                if (inp_message.value == ""){

                }else{

                if (inp_message.value.length <= 30) {
                    var params = 'message=' + inp_message.value + '&' + document.cookie;
                ajaxPost(params, "cgi-bin/message_input.py");}
                }
                }
                console.log(document.cookie);
                if (document.cookie !== ""){
            document.querySelector('#popup').style.display = 'none';
            }
            }
            function ajaxPost(params, action){
            var xhr = new XMLHttpRequest();
            xhr.open("POST", action, true);
            xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
            xhr.send(params);
            }
            function ajaxPost_2(params, action){
            var xhr = new XMLHttpRequest();
            xhr.open("POST", action, true);
            xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
            xhr.send(params);
            xhr.onreadystatechange = function(){
            if(xhr.readyState == 4 && xhr.status == 200){
            output = xhr.responseText;
            console.log(output);
            document.querySelector('#text_holder').innerHTML = output;
            }
            }
            }
            window.setInterval(function(){
                var id_message = document.querySelector('p:first-child');
                var params = 'id=' + id_message.id;
                ajaxPost_2(params, "cgi-bin/message_output.py");
                document.querySelector('#text_holder').scrollTop = 99999999;




            }
            ,1000);

        </script>
    </head>
    <body>
    <style>
        body{ background-image: url(field_image_istock-516189065.jpg) }
        .input_message{
        margin: auto;
        margin-top: 1%;
        margin-left: 35%;
        width: 100%;
        }
        #text_holder{
        padding: 20px;
        height: 50%;
        overflow: auto;
        margin:auto;
        width: 500px;
        background-color: black;
        color:white;
        border-radius: 10px;
        }
        #popup{
        z-index: 1;
        position: absolute;
        margin: auto;
        width: 100%;
        height: 30%;
        top: 0%;
        padding-top:10%;
        padding-left:40%;
        padding-bottom:70%;
        padding-right:60%;

        background-color: maroon;
        }
        #nick{
        border-radius: 3px;
        border-style: solid;
        width:20%;
        height:30%;
        font-size: 40px;
        }
        #enter{  border-radius: 5px;
        border: none;
        outline: none;
        background: rgb(212,75,56);
        padding: .7em 1.5em;
        text-decoration: none;
        font-size: 20px;
        color: #fff;
        display: inline-block;
        vertical-align: top;
        margin-left: 1%;
        width:10%;
        height: 10%;
        height:30%;
        border-radius: 3px;
        border-style: solid;
        width:10%;
        }
        #register_l{
        font-size: 30px;
        font-weight: bold;
        color: green;
        }
        #mess{
        display: inline-block;
        width:20%;
        height:10%;
        }
        #go{
        border-radius: 5px;
        border: none;
        outline: none;
        background: rgb(212,75,56);
        padding: .7em 1.5em;
        text-decoration: none;
        font-size: 20px;
        color: #fff;
        display: inline-block;
        vertical-align: top;
        margin-left: 1%;
        width:10%;
        height: 10%;
        }
        #go:hover{
        background: rgb(232,95,76);
        }
        #go:active{
        background: rgb(152,15,0);
        }
        .message{
        }
        #main{
        margin-top: 5%;

        }
        @media screen and ( max-width: 1280px ){
        #go{
        width: 30%;
        font-size: 40px;

        }
        #mess{
        width: 63%;
        margin-left: 5%;
        font-size: 40px;

        }
        .input_message{
        margin-left: 0%;

        }
        #text_holder{
        width:90%;
        height:80%;
        }
        #popup{
        margin-left:0%;

        padding-left: 5%;
        padding-right: 90%;
        padding-bottom: 90%;
        }
        #enter{
        width: 30%;
        }
        #nick{
        width: 50%;
        font-size:40px;
        }
        }
    </style>
    <div id="main">
        <div id="text_holder">
            <p id="0">Чат пуст</p>
        </div>
        <div class="input_message">
            <form>
                <textarea name="message_inp" id="mess" placeholder="Сообщение"></textarea>
                <input type="button" id="go" value="отправить">
            </form>
        </div>
    </div>
    <div id="popup">
        <form>
            <label id="register_l" >Регистрация</label>
            <br>
            <br>

            <input id="nick" required placeholder="nick" name="nick" type="text">
            <input type="button"  id="enter" value="войти">
        </form>
    </div>
    </body>
</html>
